define("components/common/Server",function(t,e,o){function a(){return{_authorization:"",_session:"",init:function(){},ajax:function(t){var e=this;if(!t.noAuth&&""==e._authorization)return void r.log("需要登陆信息");t.needLoading&&EMA.fire("load.show");try{var o={type:"POST",cache:!1,memory:!1,timeout:3e4,beforeSend:function(t){t.setRequestHeader("Accept","application/json"),this.noAuth?t.setRequestHeader("authorization",""):t.setRequestHeader("authorization",e._authorization)},dataType:"json",accepts:"json",contentType:"application/json"};t.data=t.data||{},$.extend(o,t),t.url||(o.url=i.host+t.action),t.restful&&(o.url=o.url.Format(t.restful))}catch(n){r.log(n)}o.success=function(e){EMA.fire("load.hide"),t.success(e)},o.error=function(e,o){EMA.fire("load.hide");var i=e.responseJSON||{};if("200"==e.status);else if("400"==e.status)alert(i.errorMsg||"输入参数有误");else if("401"==e.status)localStorage.removeItem("authorization"),a.setAuthorization(""),EMA.fire("login.logout"),alert(i.errorMsg||"用户授权过期。请重新登陆",function(){r.login()});else switch(e.status){case 404:alert("请求资源不存在");break;case 500:alert("服务器内部错误");break;default:switch(o){case"parsererror":alert("数据解析错误");break;case"timeout":alert("请求超时");break;case"abort":alert("连接被终止");break;default:alert("其它错误 status:"+e.status+" message:"+e.statusText)}}"function"==typeof t.error&&t.error()},"POST"==o.type&&(o.url=o.url,o.data=JSON.stringify(o.data)),r.log("ajaxData",o.data),$.ajax(o)},setAuthorization:function(t){var e=this;e._authorization=t,t&&localStorage.setItem("authorization",t)},getAuthorization:function(){var t=this;return t._authorization=localStorage.getItem("authorization"),t._authorization},getSession:function(){var t=this;return t._session},setSession:function(t){var e=this;i.develop||(e._session=t)}}}var r=t("components/common/Util"),i=t("components/common/Config");o.exports=a});